<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-light: #f8fafc;
            --bg-white: #ffffff;
            --border-color: #e2e8f0;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 1px 2px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        html, body {
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-primary);
        }

        .container-main {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: var(--bg-white);
            border-right: 1px solid var(--border-color);
            padding: 24px 0;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            box-shadow: var(--shadow);
        }

        .sidebar-header {
            padding: 0 24px 32px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 24px;
        }

        .sidebar-logo {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sidebar-nav {
            list-style: none;
        }

        .nav-item {
            margin: 8px 12px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
        }

        .nav-link:hover {
            background-color: var(--bg-light);
            color: var(--primary-color);
        }

        .nav-link.active {
            background-color: #eff6ff;
            color: var(--primary-color);
            border-left: 3px solid var(--primary-color);
            padding-left: 13px;
        }

        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 32px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .header-actions {
            display: flex;
            gap: 16px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background-color: var(--bg-light);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: #f1f5f9;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .card {
            background: var(--bg-white);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .card-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            margin-top: 8px;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            background-color: var(--bg-light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .invoice-section {
            background: var(--bg-white);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 16px;
        }

        .section-header h2 {
            font-size: 18px;
            font-weight: 700;
        }

        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-input,
        .filter-select {
            padding: 10px 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .filter-input:focus,
        .filter-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .table-responsive {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background-color: var(--bg-light);
            border-bottom: 2px solid var(--border-color);
        }

        th {
            padding: 12px 16px;
            text-align: left;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        tbody tr:hover {
            background-color: var(--bg-light);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: capitalize;
        }

        .badge-draft {
            background-color: #f3f4f6;
            color: #4b5563;
        }

        .badge-pending {
            background-color: #fef3c7;
            color: #92400e;
        }

        .badge-paid {
            background-color: #dcfce7;
            color: #166534;
        }

        .actions-cell {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .action-btn:hover {
            background-color: var(--primary-hover);
        }

        .action-btn-delete {
            background-color: var(--danger-color);
        }

        .action-btn-delete:hover {
            background-color: #dc2626;
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .empty-state p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--bg-white);
            padding: 32px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-header {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .modal-body {
            color: var(--text-secondary);
            margin-bottom: 24px;
            font-size: 14px;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-section {
            margin-bottom: 32px;
        }

        .form-section h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .meta-field {
            margin-bottom: 16px;
        }

        .meta-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .meta-value {
            font-size: 14px;
            color: var(--text-primary);
            font-weight: 500;
        }

        .totals-box {
            border-left: 2px solid var(--border-color);
            padding-left: 24px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .total-row.grand {
            border-top: 1px solid var(--border-color);
            padding-top: 12px;
            font-size: 18px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .notes-section {
            background-color: var(--bg-light);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 32px;
        }

        .notes-title {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .notes-content {
            font-size: 14px;
            color: var(--text-primary);
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .view {
            display: none;
        }

        .view.active {
            display: block;
        }

        .error-message {
            background-color: #fee2e2;
            color: #991b1b;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border-left: 4px solid var(--danger-color);
        }

        .success-message {
            background-color: #dcfce7;
            color: #166534;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            border-left: 4px solid var(--success-color);
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
            }

            .main-content {
                margin-left: 0;
                padding: 20px;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .form-two-col {
                grid-template-columns: 1fr;
            }

            .table-responsive {
                font-size: 12px;
            }

            th, td {
                padding: 10px 8px;
            }
        }

        @media print {
            .sidebar,
            .header-actions,
            .filters,
            .section-header,
            .action-btn,
            .btn {
                display: none !important;
            }

            body {
                background: white;
            }

            .main-content {
                margin-left: 0;
                padding: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container-main">
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="#" class="sidebar-logo">
                    üíº Invoice Hub
                </a>
            </div>
            <nav>
                <ul class="sidebar-nav">
                    <li class="nav-item">
                        <button class="nav-link active" id="nav-dashboard" data-view="dashboard">
                            üìä Dashboard
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="nav-create" data-view="create-invoice">
                            ‚ûï Create Invoice
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="nav-invoices" data-view="all-invoices">
                            üìã All Invoices
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" id="nav-clients" data-view="manage-clients">
                            üë• Manage Clients
                        </button>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <section id="dashboard" class="view active">
                <div class="header">
                    <h1>Dashboard</h1>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="btn-create-new">
                            ‚ûï New Invoice
                        </button>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-label">Total Invoices</div>
                                <div class="card-value" id="total-invoices">0</div>
                            </div>
                            <div class="card-icon">üìÑ</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-label">Total Revenue</div>
                                <div class="card-value" id="total-revenue">‚Çπ0.00</div>
                            </div>
                            <div class="card-icon">üí∞</div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div>
                                <div class="card-label">Pending Amount</div>
                                <div class="card-value" id="pending-amount">‚Çπ0.00</div>
                            </div>
                            <div class="card-icon">‚è≥</div>
                        </div>
                    </div>
                </div>

                <div class="invoice-section">
                    <div class="section-header">
                        <h2>Recent Invoices</h2>
                    </div>

                    <div class="filters">
                        <input 
                            type="text" 
                            class="filter-input" 
                            id="search-invoice" 
                            placeholder="Search by invoice number or client..."
                        >
                        <select class="filter-select" id="filter-status">
                            <option value="">All Status</option>
                            <option value="Draft">Draft</option>
                            <option value="Pending">Pending</option>
                            <option value="Paid">Paid</option>
                        </select>
                    </div>

                    <div class="table-responsive">
                        <table id="invoices-table">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Client</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invoices-tbody">
                                <tr>
                                    <td colspan="6" class="empty-state">
                                        <div class="empty-state-icon">üì≠</div>
                                        <h3>No invoices yet</h3>
                                        <p>Create your first invoice to get started</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="create-invoice" class="view">
                <div class="header">
                    <h1 id="create-title">Create Invoice</h1>
                </div>

                <div class="invoice-section" style="max-width: 900px;">
                    <div id="form-message"></div>
                    <form id="invoice-form">
                        <div class="form-section">
                            <h3>Customer Information</h3>
                            <div class="form-two-col">
                                <div class="form-group">
                                    <label class="form-label">Select Client *</label>
                                    <select class="form-select" name="client_id" id="client-select" required>
                                        <option value="">-- Loading Clients --</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Customer Email</label>
                                    <input type="email" class="form-input" name="customer_email" placeholder="customer@example.com">
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Billing Address *</label>
                                <textarea class="form-textarea" name="billing_address" placeholder="Street, City, State, ZIP Code" required></textarea>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Invoice Dates</h3>
                            <div class="form-two-col">
                                <div class="form-group">
                                    <label class="form-label">Invoice Date *</label>
                                    <input type="date" class="form-input" name="invoice_date" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Due Date *</label>
                                    <input type="date" class="form-input" name="due_date" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                                <h3>Line Items</h3>
                                <button type="button" class="btn btn-secondary btn-small" id="add-line-item">
                                    + Add Item
                                </button>
                            </div>

                            <div class="table-responsive">
                                <table id="line-items-table">
                                    <thead>
                                        <tr>
                                            <th>Item Description</th>
                                            <th>Quantity</th>
                                            <th>Unit Price (‚Çπ)</th>
                                            <th>GST %</th>
                                            <th>Amount (‚Çπ)</th>
                                            <th>Action</th>
                                        </tr>
                                    </thead>
                                    <tbody id="line-items-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div style="margin-bottom: 32px; display: grid; grid-template-columns: 1fr 300px; gap: 24px;">
                            <div>
                                <label class="form-label">Notes & Payment Terms</label>
                                <textarea class="form-textarea" name="notes" placeholder="Thank you for your business!" style="min-height: 120px;"></textarea>
                            </div>
                            <div style="border-left: 1px solid var(--border-color); padding-left: 24px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 12px;">
                                    <span>Subtotal:</span>
                                    <span style="font-weight: 600;" id="subtotal">‚Çπ0.00</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 16px; padding-bottom: 16px; border-bottom: 1px solid var(--border-color);">
                                    <span>GST:</span>
                                    <span style="font-weight: 600;" id="tax-total">‚Çπ0.00</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: 700;">
                                    <span>Grand Total:</span>
                                    <span id="grand-total">‚Çπ0.00</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 24px;">
                            <label class="form-label">Invoice Status</label>
                            <select class="form-select" name="status" required>
                                <option value="Draft">Draft</option>
                                <option value="Pending">Pending</option>
                                <option value="Paid">Paid</option>
                            </select>
                        </div>

                        <div style="display: flex; gap: 12px;">
                            <button type="submit" class="btn btn-primary">Save Invoice</button>
                            <button type="button" class="btn btn-secondary" id="btn-cancel">Cancel</button>
                        </div>
                    </form>
                </div>
            </section>

            <section id="all-invoices" class="view">
                <div class="header">
                    <h1>All Invoices</h1>
                </div>

                <div class="invoice-section">
                    <div class="section-header">
                        <h2>Invoice List</h2>
                    </div>

                    <div class="filters">
                        <input 
                            type="text" 
                            class="filter-input" 
                            id="search-all-invoices" 
                            placeholder="Search by invoice number or client..."
                        >
                        <select class="filter-select" id="filter-all-status">
                            <option value="">All Status</option>
                            <option value="Draft">Draft</option>
                            <option value="Pending">Pending</option>
                            <option value="Paid">Paid</option>
                        </select>
                    </div>

                    <div class="table-responsive">
                        <table id="all-invoices-table">
                            <thead>
                                <tr>
                                    <th>Invoice #</th>
                                    <th>Client</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Due Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="all-invoices-tbody">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 32px; color: var(--text-secondary);">
                                        No invoices found
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="invoice-details" class="view">
                <div class="header">
                    <h1 id="detail-title">Invoice Details</h1>
                    <div class="header-actions">
                        <button class="btn btn-secondary" id="btn-back-details">‚Üê Back</button>
                        <button class="btn btn-secondary" id="btn-print">üñ®Ô∏è Print</button>
                        <button class="btn btn-secondary" id="btn-edit">‚úèÔ∏è Edit</button>
                        <button class="btn btn-danger" id="btn-delete">üóëÔ∏è Delete</button>
                    </div>
                </div>

                <div id="invoice-preview" style="background: var(--bg-white); border: 1px solid var(--border-color); border-radius: 12px; padding: 48px; max-width: 900px; margin: 0 auto;">
                </div>
            </section>

            <section id="manage-clients" class="view">
                <div class="header">
                    <h1>Manage Clients</h1>
                </div>

                <div class="invoice-section" style="max-width: 600px;">
                    <div id="client-message"></div>
                    <form id="client-form">
                        <h3 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">Add New Client</h3>
                        <div style="display: flex; gap: 12px; margin-bottom: 24px;">
                            <input 
                                type="text" 
                                class="filter-input" 
                                id="new-client-name"
                                placeholder="Enter client name"
                                style="flex: 1;"
                            >
                            <button type="submit" class="btn btn-primary">Add Client</button>
                        </div>
                    </form>

                    <div>
                        <h3 style="margin-bottom: 16px; font-size: 16px; font-weight: 600;">Existing Clients</h3>
                        <div id="clients-list" style="display: grid; gap: 12px;">
                            <p style="color: var(--text-secondary);">Loading clients...</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="confirm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Confirm Delete</div>
            <div class="modal-body">Are you sure you want to delete this invoice? This action cannot be undone.</div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modal-cancel">Cancel</button>
                <button class="btn btn-danger" id="modal-confirm">Delete</button>
            </div>
        </div>
    </div>

    <script>
        const formatCurrency = (amount) => {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(amount);
        };

        const formatDate = (date) => {
            return new Date(date).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        };

        let currentView = 'dashboard';
        let currentInvoiceId = null;
        let currentEditingId = null;
        let lineItemCount = 0;
        let allClients = [];

        const DataStore = {
            invoices: [],
            clients: [],
            nextInvoiceId: 1,

            init() {
                this.loadData();
                if (this.clients.length === 0) {
                    this.initDefaultClients();
                }
            },

            loadData() {
                try {
                    const invoices = localStorage.getItem('invoices_data');
                    const clients = localStorage.getItem('clients_data');
                    this.invoices = invoices ? JSON.parse(invoices) : [];
                    this.clients = clients ? JSON.parse(clients) : [];
                    this.nextInvoiceId = this.invoices.length > 0 ? Math.max(...this.invoices.map(i => i.id)) + 1 : 1;
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            },

            saveData() {
                localStorage.setItem('invoices_data', JSON.stringify(this.invoices));
                localStorage.setItem('clients_data', JSON.stringify(this.clients));
                allClients = [...this.clients];
            },

            initDefaultClients() {
                this.clients = [
                    { id: 1, name: 'TCS' },
                    { id: 2, name: 'Infosys' },
                    { id: 3, name: 'Wipro' },
                    { id: 4, name: 'HCL' },
                    { id: 5, name: 'Accenture' }
                ];
                this.saveData();
            },

            addClient(name) {
                const trimmedName = name.trim();
                if (!trimmedName || trimmedName.length < 2) {
                    return { success: false, message: 'Client name must be at least 2 characters' };
                }
                if (this.clients.some(c => c.name.toLowerCase() === trimmedName.toLowerCase())) {
                    return { success: false, message: 'Client already exists' };
                }
                const client = { id: Date.now(), name: trimmedName };
                this.clients.push(client);
                this.saveData();
                return { success: true, message: 'Client added successfully', client };
            },

            removeClient(id) {
                this.clients = this.clients.filter(c => c.id !== id);
                this.saveData();
                return true;
            },

            createInvoice(data) {
                const invoice = {
                    id: this.nextInvoiceId++,
                    invoice_number: `INV-${String(this.nextInvoiceId).padStart(5, '0')}`,
                    ...data,
                    created_at: new Date().toISOString()
                };
                this.invoices.push(invoice);
                this.saveData();
                return invoice;
            },

            updateInvoice(id, data) {
                const index = this.invoices.findIndex(i => i.id === id);
                if (index !== -1) {
                    this.invoices[index] = { ...this.invoices[index], ...data };
                    this.saveData();
                    return this.invoices[index];
                }
                return null;
            },

            deleteInvoice(id) {
                this.invoices = this.invoices.filter(i => i.id !== id);
                this.saveData();
                return true;
            },

            getInvoice(id) {
                return this.invoices.find(i => i.id === id);
            },

            getAllInvoices() {
                return this.invoices;
            },

            getClients() {
                return this.clients;
            }
        };

        const Views = {
            show(viewName) {
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.getElementById(viewName).classList.add('active');
                currentView = viewName;
                this.updateNav(viewName);
            },

            updateNav(viewName) {
                document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
                const navButton = document.querySelector(`[data-view="${viewName}"]`);
                if (navButton) navButton.classList.add('active');
            }
        };

        document.querySelectorAll('[data-view]').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                Views.show(btn.dataset.view);
            });
        });

        const Dashboard = {
            init() {
                this.loadInvoices();
                this.updateAnalytics();
                document.getElementById('search-invoice').addEventListener('input', () => this.filterInvoices());
                document.getElementById('filter-status').addEventListener('change', () => this.filterInvoices());
            },

            loadInvoices() {
                const invoices = DataStore.getAllInvoices().slice(-5);
                const tbody = document.getElementById('invoices-tbody');

                if (invoices.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" class="empty-state">
                                <div class="empty-state-icon">üì≠</div>
                                <h3>No invoices yet</h3>
                                <p>Create your first invoice to get started</p>
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = invoices.map(invoice => `
                    <tr>
                        <td><strong>${invoice.invoice_number}</strong></td>
                        <td>${invoice.customer_name}</td>
                        <td>${formatCurrency(invoice.grand_total)}</td>
                        <td>${formatDate(invoice.invoice_date)}</td>
                        <td><span class="badge badge-${invoice.status.toLowerCase()}">${invoice.status}</span></td>
                        <td>
                            <div class="actions-cell">
                                <button class="action-btn" onclick="showInvoiceDetails(${invoice.id})">View</button>
                                <button class="action-btn action-btn-delete" onclick="deleteInvoiceModal(${invoice.id})">Delete</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            filterInvoices() {
                const search = document.getElementById('search-invoice').value.toLowerCase();
                const status = document.getElementById('filter-status').value;
                const invoices = DataStore.getAllInvoices();

                const filtered = invoices.filter(invoice => {
                    const matchesSearch = invoice.invoice_number.toLowerCase().includes(search) ||
                                        invoice.customer_name.toLowerCase().includes(search);
                    const matchesStatus = !status || invoice.status === status;
                    return matchesSearch && matchesStatus;
                });

                const tbody = document.getElementById('invoices-tbody');
                if (filtered.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 32px; color: var(--text-secondary);">
                                No invoices match your filters
                            </td>
                        </tr>
                    `;
                    return;
                }

                tbody.innerHTML = filtered.map(invoice => `
                    <tr>
                        <td><strong>${invoice.invoice_number}</strong></td>
                        <td>${invoice.customer_name}</td>
                        <td>${formatCurrency(invoice.grand_total)}</td>
                        <td>${formatDate(invoice.invoice_date)}</td>
                        <td><span class="badge badge-${invoice.status.toLowerCase()}">${invoice.status}</span></td>
                        <td>
                            <div class="actions-cell">
                                <button class="action-btn" onclick="showInvoiceDetails(${invoice.id})">View</button>
                                <button class="action-btn action-btn-delete" onclick="deleteInvoiceModal(${invoice.id})">Delete</button>
                            </div>
                        </td>
                    </tr>
                `).join('');
            },

            updateAnalytics() {
                const invoices = DataStore.getAllInvoices();
                const totalRevenue = invoices.reduce((sum, inv) => sum + (inv.grand_total || 0), 0);
                const pendingAmount = invoices
                    .filter(inv => inv.status === 'Pending')
                    .reduce((sum, inv) => sum + (inv.grand_total || 0), 0);

                document.getElementById('total-invoices').textContent = invoices.length;
                document.getElementById('total-revenue').textContent = formatCurrency(totalRevenue);
                document.getElementById('pending-amount').textContent = formatCurrency(pendingAmount);
            }
        };

        const showMessage = (elementId, message, type = 'success') => {
            const el = document.getElementById(elementId);
            if (el) {
                el.innerHTML = `<div class="${type}-message">${message}</div>`;
                setTimeout(() => el.innerHTML = '', 3000);
            }
        };

        const initializeClientSelect = () => {
            const select = document.getElementById('client-select');
            select.innerHTML = '<option value="">-- Select Client --</option>';
            DataStore.getClients().forEach(client => {
                const option = document.createElement('option');
                option.value = client.id;
                option.textContent = client.name;
                select.appendChild(option);
            });
            allClients = DataStore.getClients();
        };

        const addLineItem = (itemData = null) => {
            const tbody = document.getElementById('line-items-body');
            const itemId = lineItemCount++;
            const row = document.createElement('tr');
            row.className = 'invoice-item-row';
            row.innerHTML = `
                <td>
                    <input type="text" class="form-input" value="${itemData?.description || ''}" placeholder="Item description" data-item-id="${itemId}" data-field="description" style="width: 100%; margin: 0;">
                </td>
                <td>
                    <input type="number" class="form-input" value="${itemData?.quantity || 1}" placeholder="1" min="1" step="1" data-item-id="${itemId}" data-field="quantity" style="width: 100%; margin: 0;">
                </td>
                <td>
                    <input type="number" class="form-input" value="${itemData?.unit_price || 0}" placeholder="0.00" min="0" step="0.01" data-item-id="${itemId}" data-field="unit_price" style="width: 100%; margin: 0;">
                </td>
                <td>
                    <input type="number" class="form-input" value="${itemData?.gst_percentage || 18}" placeholder="0" min="0" max="100" step="0.01" data-item-id="${itemId}" data-field="gst_percentage" style="width: 100%; margin: 0;">
                </td>
                <td>
                    <span style="font-weight: 600;" data-total="${itemId}">‚Çπ0.00</span>
                </td>
                <td>
                    <button type="button" class="btn btn-danger btn-small" onclick="removeLineItem(${itemId})" style="margin: 0;">Remove</button>
                </td>
            `;

            row.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', calculateTotals);
            });

            tbody.appendChild(row);
            calculateTotals();
        };

        const removeLineItem = (itemId) => {
            const row = document.querySelector(`[data-item-id="${itemId}"]`)?.closest('tr');
            if (row) {
                row.remove();
                calculateTotals();
            }
        };

        const calculateTotals = () => {
            let subtotal = 0;
            let totalGst = 0;

            document.querySelectorAll('#line-items-body tr').forEach(row => {
                const quantity = parseFloat(row.querySelector('[data-field="quantity"]')?.value) || 0;
                const unitPrice = parseFloat(row.querySelector('[data-field="unit_price"]')?.value) || 0;
                const gstPercentage = parseFloat(row.querySelector('[data-field="gst_percentage"]')?.value) || 0;

                const itemTotal = quantity * unitPrice;
                const itemGst = (itemTotal * gstPercentage) / 100;

                subtotal += itemTotal;
                totalGst += itemGst;

                const totalSpan = row.querySelector('[data-total]');
                if (totalSpan) {
                    totalSpan.textContent = formatCurrency(itemTotal + itemGst);
                }
            });

            const grandTotal = subtotal + totalGst;
            document.getElementById('subtotal').textContent = formatCurrency(subtotal);
            document.getElementById('tax-total').textContent = formatCurrency(totalGst);
            document.getElementById('grand-total').textContent = formatCurrency(grandTotal);
        };

        const handleInvoiceFormSubmit = (e) => {
            e.preventDefault();

            const items = [];
            document.querySelectorAll('#line-items-body tr').forEach(row => {
                const description = row.querySelector('[data-field="description"]')?.value || '';
                const quantity = parseFloat(row.querySelector('[data-field="quantity"]')?.value) || 0;
                const unitPrice = parseFloat(row.querySelector('[data-field="unit_price"]')?.value) || 0;
                const gstPercentage = parseFloat(row.querySelector('[data-field="gst_percentage"]')?.value) || 0;

                if (description && quantity > 0 && unitPrice > 0) {
                    items.push({
                        description,
                        quantity,
                        unit_price: unitPrice,
                        gst_percentage: gstPercentage
                    });
                }
            });

            if (items.length === 0) {
                showMessage('form-message', 'Please add at least one line item', 'error');
                return;
            }

            const form = document.getElementById('invoice-form');
            const clientId = form.querySelector('[name="client_id"]').value;
            const client = DataStore.getClients().find(c => c.id == clientId);

            if (!client) {
                showMessage('form-message', 'Please select a valid client', 'error');
                return;
            }

            if (!form.querySelector('[name="invoice_date"]').value) {
                showMessage('form-message', 'Please enter invoice date', 'error');
                return;
            }

            if (!form.querySelector('[name="due_date"]').value) {
                showMessage('form-message', 'Please enter due date', 'error');
                return;
            }

            const subtotal = parseFloat(document.getElementById('subtotal').textContent.replace('‚Çπ', '').replace(/,/g, '')) || 0;
            const taxTotal = parseFloat(document.getElementById('tax-total').textContent.replace('‚Çπ', '').replace(/,/g, '')) || 0;
            const grandTotal = parseFloat(document.getElementById('grand-total').textContent.replace('‚Çπ', '').replace(/,/g, '')) || 0;

            const data = {
                client_id: clientId,
                customer_name: client.name,
                customer_email: form.querySelector('[name="customer_email"]').value,
                billing_address: form.querySelector('[name="billing_address"]').value,
                invoice_date: form.querySelector('[name="invoice_date"]').value,
                due_date: form.querySelector('[name="due_date"]').value,
                notes: form.querySelector('[name="notes"]').value,
                status: form.querySelector('[name="status"]').value,
                items: items,
                subtotal: subtotal,
                tax_total: taxTotal,
                grand_total: grandTotal
            };

            if (currentEditingId) {
                DataStore.updateInvoice(currentEditingId, data);
                showMessage('form-message', 'Invoice updated successfully!', 'success');
                currentEditingId = null;
                document.getElementById('create-title').textContent = 'Create Invoice';
            } else {
                DataStore.createInvoice(data);
                showMessage('form-message', 'Invoice created successfully!', 'success');
            }

            setTimeout(() => {
                form.reset();
                lineItemCount = 0;
                document.getElementById('line-items-body').innerHTML = '';
                Views.show('dashboard');
                Dashboard.loadInvoices();
                Dashboard.updateAnalytics();
            }, 500);
        };

        document.getElementById('invoice-form').addEventListener('submit', handleInvoiceFormSubmit);
        document.getElementById('add-line-item').addEventListener('click', () => addLineItem());

        document.getElementById('btn-cancel').addEventListener('click', () => {
            document.getElementById('invoice-form').reset();
            lineItemCount = 0;
            document.getElementById('line-items-body').innerHTML = '';
            currentEditingId = null;
            document.getElementById('create-title').textContent = 'Create Invoice';
            Views.show('dashboard');
        });

        const showInvoiceDetails = (invoiceId) => {
            currentInvoiceId = invoiceId;
            const invoice = DataStore.getInvoice(invoiceId);
            if (!invoice) return;

            document.getElementById('detail-title').textContent = `Invoice ${invoice.invoice_number}`;
            renderInvoiceDetails(invoice);
            Views.show('invoice-details');
        };

        const renderInvoiceDetails = (invoice) => {
            const itemsRows = invoice.items.map(item => `
                <tr>
                    <td>${item.description}</td>
                    <td style="text-align: center;">${item.quantity}</td>
                    <td style="text-align: right;">${formatCurrency(item.unit_price)}</td>
                    <td style="text-align: center;">${item.gst_percentage}%</td>
                    <td style="text-align: right; font-weight: 600;">${formatCurrency(item.quantity * item.unit_price * (1 + item.gst_percentage / 100))}</td>
                </tr>
            `).join('');

            const preview = document.getElementById('invoice-preview');
            preview.innerHTML = `
                <div style="margin-bottom: 48px; display: grid; grid-template-columns: 1fr 1fr; gap: 48px;">
                    <div>
                        <div style="font-size: 24px; font-weight: 700; color: var(--primary-color); margin-bottom: 32px;">Invoice Hub</div>
                        <div class="meta-field">
                            <div class="meta-label">Invoice Number</div>
                            <div class="meta-value">${invoice.invoice_number}</div>
                        </div>
                    </div>
                    <div>
                        <div style="border: 2px solid var(--primary-color); border-radius: 8px; padding: 16px; text-align: center; margin-bottom: 16px;">
                            <div class="meta-label" style="margin-bottom: 8px;">Status</div>
                            <span class="badge badge-${invoice.status.toLowerCase()}" style="font-size: 14px; padding: 8px 16px;">${invoice.status}</span>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 48px; display: grid; grid-template-columns: 1fr 1fr; gap: 48px; padding-bottom: 32px; border-bottom: 1px solid var(--border-color);">
                    <div>
                        <div style="margin-bottom: 24px;">
                            <div class="meta-label">Bill To</div>
                            <div class="meta-value" style="margin-top: 8px;">
                                <strong>${invoice.customer_name}</strong><br>
                                ${invoice.customer_email ? `${invoice.customer_email}<br>` : ''}
                                ${invoice.billing_address.split('\n').join('<br>')}
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="meta-field">
                            <div class="meta-label">Invoice Date</div>
                            <div class="meta-value">${formatDate(invoice.invoice_date)}</div>
                        </div>
                        <div class="meta-field">
                            <div class="meta-label">Due Date</div>
                            <div class="meta-value">${formatDate(invoice.due_date)}</div>
                        </div>
                    </div>
                </div>

                <div class="invoice-table" style="margin-bottom: 32px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th style="text-align: center;">Quantity</th>
                                <th style="text-align: right;">Unit Price</th>
                                <th style="text-align: center;">GST %</th>
                                <th style="text-align: right;">Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsRows}
                        </tbody>
                    </table>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 300px; gap: 48px; margin-bottom: 32px;">
                    <div>
                        ${invoice.notes ? `
                            <div class="notes-section">
                                <div class="notes-title">Notes</div>
                                <div class="notes-content">${invoice.notes}</div>
                            </div>
                        ` : ''}
                    </div>
                    <div class="totals-box">
                        <div class="total-row">
                            <span>Subtotal:</span>
                            <span>${formatCurrency(invoice.subtotal)}</span>
                        </div>
                        <div class="total-row">
                            <span>GST:</span>
                            <span>${formatCurrency(invoice.tax_total)}</span>
                        </div>
                        <div class="total-row grand">
                            <span>Grand Total:</span>
                            <span>${formatCurrency(invoice.grand_total)}</span>
                        </div>
                    </div>
                </div>

                <div style="border-top: 1px solid var(--border-color); padding-top: 24px; text-align: center; color: var(--text-secondary); font-size: 12px;">
                    Thank you for your business!
                </div>
            `;
        };

        document.getElementById('btn-back-details').addEventListener('click', () => Views.show('dashboard'));
        document.getElementById('btn-print').addEventListener('click', () => {
            setTimeout(() => window.print(), 100);
        });

        // ========== API SIMULATION (For local testing without backend) ==========
        // This layer simulates Flask API responses using localStorage
        const API = {
            getClients() {
                return DataStore.getClients();
            },
            
            addClient(name) {
                return DataStore.addClient(name);
            },
            
            createInvoice(data) {
                return DataStore.createInvoice(data);
            },
            
            updateInvoice(id, data) {
                return DataStore.updateInvoice(id, data);
            },
            
            deleteInvoice(id) {
                return DataStore.deleteInvoice(id);
            },
            
            getInvoice(id) {
                return DataStore.getInvoice(id);
            },
            
            getAllInvoices() {
                return DataStore.getAllInvoices();
            }
        };

        document.getElementById('btn-edit').addEventListener('click', () => {
            if (!currentInvoiceId) return;
            const invoice = DataStore.getInvoice(currentInvoiceId);
            if (!invoice) return;

            currentEditingId = currentInvoiceId;
            document.getElementById('create-title').textContent = 'Edit Invoice';
            const form = document.getElementById('invoice-form');
            form.querySelector('[name="client_id"]').value = invoice.client_id;
            form.querySelector('[name="customer_email"]').value = invoice.customer_email;
            form.querySelector('[name="billing_address"]').value = invoice.billing_address;
            form.querySelector('[name="invoice_date"]').value = invoice.invoice_date;
            form.querySelector('[name="due_date"]').value = invoice.due_date;
            form.querySelector('[name="notes"]').value = invoice.notes;
            form.querySelector('[name="status"]').value = invoice.status;

            const tbody = document.getElementById('line-items-body');
            tbody.innerHTML = '';
            lineItemCount = 0;
            invoice.items.forEach(item => addLineItem(item));

            Views.show('create-invoice');
            setTimeout(() => {
                document.getElementById('invoice-form').scrollIntoView({ behavior: 'smooth' });
            }, 100);
        });

        document.getElementById('btn-delete').addEventListener('click', () => {
            if (currentInvoiceId) {
                deleteInvoiceModal(currentInvoiceId);
            }
        });

        const deleteInvoiceModal = (invoiceId) => {
            const modal = document.getElementById('confirm-modal');
            modal.classList.add('active');

            const confirmBtn = document.getElementById('modal-confirm');
            const cancelBtn = document.getElementById('modal-cancel');
            
            const newConfirmBtn = confirmBtn.cloneNode(true);
            const newCancelBtn = cancelBtn.cloneNode(true);
            confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);
            cancelBtn.parentNode.replaceChild(newCancelBtn, cancelBtn);

            newConfirmBtn.addEventListener('click', () => {
                DataStore.deleteInvoice(invoiceId);
                modal.classList.remove('active');
                currentInvoiceId = null;
                currentEditingId = null;
                Views.show('dashboard');
                Dashboard.loadInvoices();
                Dashboard.updateAnalytics();
            });

            newCancelBtn.addEventListener('click', () => {
                modal.classList.remove('active');
            });
        };

        document.querySelectorAll('[data-view="all-invoices"]').forEach(btn => {
            btn.addEventListener('click', () => {
                loadAllInvoices();
                Views.show('all-invoices');
            });
        });

        const loadAllInvoices = () => {
            const invoices = DataStore.getAllInvoices();
            const tbody = document.getElementById('all-invoices-tbody');

            if (invoices.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 32px; color: var(--text-secondary);">
                            No invoices found
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = invoices.map(invoice => `
                <tr>
                    <td><strong>${invoice.invoice_number}</strong></td>
                    <td>${invoice.customer_name}</td>
                    <td>${formatCurrency(invoice.grand_total)}</td>
                    <td>${formatDate(invoice.invoice_date)}</td>
                    <td>${formatDate(invoice.due_date)}</td>
                    <td><span class="badge badge-${invoice.status.toLowerCase()}">${invoice.status}</span></td>
                    <td>
                        <div class="actions-cell">
                            <button class="action-btn" onclick="showInvoiceDetails(${invoice.id})">View</button>
                            <button class="action-btn action-btn-delete" onclick="deleteInvoiceModal(${invoice.id})">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');

            document.getElementById('search-all-invoices').addEventListener('input', filterAllInvoices);
            document.getElementById('filter-all-status').addEventListener('change', filterAllInvoices);
        };

        const filterAllInvoices = () => {
            const search = document.getElementById('search-all-invoices').value.toLowerCase();
            const status = document.getElementById('filter-all-status').value;
            const invoices = DataStore.getAllInvoices();

            const filtered = invoices.filter(invoice => {
                const matchesSearch = invoice.invoice_number.toLowerCase().includes(search) ||
                                    invoice.customer_name.toLowerCase().includes(search);
                const matchesStatus = !status || invoice.status === status;
                return matchesSearch && matchesStatus;
            });

            const tbody = document.getElementById('all-invoices-tbody');
            if (filtered.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 32px; color: var(--text-secondary);">
                            No invoices match your filters
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = filtered.map(invoice => `
                <tr>
                    <td><strong>${invoice.invoice_number}</strong></td>
                    <td>${invoice.customer_name}</td>
                    <td>${formatCurrency(invoice.grand_total)}</td>
                    <td>${formatDate(invoice.invoice_date)}</td>
                    <td>${formatDate(invoice.due_date)}</td>
                    <td><span class="badge badge-${invoice.status.toLowerCase()}">${invoice.status}</span></td>
                    <td>
                        <div class="actions-cell">
                            <button class="action-btn" onclick="showInvoiceDetails(${invoice.id})">View</button>
                            <button class="action-btn action-btn-delete" onclick="deleteInvoiceModal(${invoice.id})">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        };

        document.getElementById('client-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const nameInput = document.getElementById('new-client-name');
            const name = nameInput.value.trim();

            if (!name) {
                showMessage('client-message', 'Please enter a client name', 'error');
                return;
            }

            const result = DataStore.addClient(name);
            if (result.success) {
                nameInput.value = '';
                renderClientsList();
                initializeClientSelect();
                showMessage('client-message', result.message, 'success');
            } else {
                showMessage('client-message', result.message, 'error');
            }
        });

        const renderClientsList = () => {
            const container = document.getElementById('clients-list');
            const clients = DataStore.getClients();

            if (clients.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary);">No clients added yet.</p>';
                return;
            }

            container.innerHTML = clients.map(client => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px; background-color: var(--bg-light); border-radius: 8px; border-left: 3px solid var(--primary-color);">
                    <span style="font-weight: 500;">${client.name}</span>
                    <button type="button" class="btn btn-danger btn-small" onclick="deleteClient(${client.id})" style="margin: 0;">
                        Remove
                    </button>
                </div>
            `).join('');
        };

        const deleteClient = (id) => {
            if (confirm('Are you sure you want to remove this client?')) {
                DataStore.removeClient(id);
                renderClientsList();
                initializeClientSelect();
            }
        };

        document.getElementById('btn-create-new').addEventListener('click', () => {
            document.getElementById('invoice-form').reset();
            lineItemCount = 0;
            document.getElementById('line-items-body').innerHTML = '';
            addLineItem();
            initializeClientSelect();
            currentEditingId = null;
            document.getElementById('create-title').textContent = 'Create Invoice';
            Views.show('create-invoice');
        });

        const today = new Date().toISOString().split('T')[0];

        document.addEventListener('DOMContentLoaded', () => {
            DataStore.init();
            Dashboard.init();
            initializeClientSelect();
            renderClientsList();

            const invoiceDateInput = document.querySelector('[name="invoice_date"]');
            if (invoiceDateInput && !invoiceDateInput.value) {
                invoiceDateInput.value = today;
            }
        });

        document.querySelectorAll('[data-view="manage-clients"]').forEach(btn => {
            btn.addEventListener('click', () => {
                renderClientsList();
                Views.show('manage-clients');
            });
        });
    </script>
</body>
</html>
